#!/usr/bin/env sh
# Pre-push hook - Created by Balaji Koneti
. "$(dirname -- "$0")/_/husky.sh"

echo "🚀 Running pre-push checks..."

# Run tests for all services
echo "🧪 Running tests..."

# Backend tests
if [ -d "backend" ]; then
  echo "📦 Testing backend..."
  cd backend
  npm run test:ci
  if [ $? -ne 0 ]; then
    echo "❌ Backend tests failed!"
    exit 1
  fi
  cd ..
fi

# Frontend tests
if [ -d "frontend" ]; then
  echo "📦 Testing frontend..."
  cd frontend
  npm run test:run
  if [ $? -ne 0 ]; then
    echo "❌ Frontend tests failed!"
    exit 1
  fi
  cd ..
fi

# ML tests
if [ -d "ml" ]; then
  echo "📦 Testing ML service..."
  cd ml
  python -m pytest tests/ -v --cov=src --cov-report=term-missing
  if [ $? -ne 0 ]; then
    echo "❌ ML tests failed!"
    exit 1
  fi
  cd ..
fi

echo "✅ All tests passed! Ready to push."
